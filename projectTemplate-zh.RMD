红葡萄酒质量探索分析
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# 加载你最终使用的所有组件
# 在这个代码块的分析中。
rw <- read.csv('wineQualityReds.csv')
# 注意，在这个代码块中，将参数 "echo" 设为假。
# This prevents the code from displaying in the knitted HTML output.这可以避免代码混入 HTML 输出显示。
# 应当在文件中，对所有代码块设为 echo=FALSE 。
library(ggplot2)
```


本报告探讨了一个包含大约1599种红葡萄酒的质量和属性的数据集。


# 单变量绘图选择
```{r echo=FALSE, message=FALSE}
#数据集大小
dim(rw)
```
```{r echo=FALSE, message=FALSE}
#数据集汇总信息
str(rw)
summary(rw)
```

观察可得出该数据集共有1599个观察值，13个变量。


```{r echo=FALSE, Univariate_Plots}
#绘制质量直方图
quality.f <- factor(rw$quality)
qplot(x = quality.f, data = rw)
```


```{r echo=FALSE}
table(quality.f)
```

红葡萄酒的质量评级中最高和最低的比较少，大多数集中在5-6的中间位置。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = fixed.acidity, data = rw, ylab = 'count') +
  scale_x_continuous(breaks = seq(0, 16, 1))
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(rw$fixed.acidity)
```

大多数红葡萄酒的固定酸度含量在7-9（g/dm^3)之间，中位数是7.90（g/dm^3)， 平均值为8.32（g/dm^3).


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = volatile.acidity, data = rw, ylab = 'count')
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(rw$volatile.acidity)
```

大多数挥发性酸度含量在0.3-0.7（g/dm^3)之间，中位数为0.5200（g/dm^3)，平均值是0.5278（g/dm^3)。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = citric.acid, data = rw, ylab = 'count')
```

柠檬酸含量大多数在0-0.5（g/dm^3)之间，相比于以上两种酸，柠檬酸的含量较小。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = residual.sugar, data = rw, ylab = 'count')
```

从图中可以看出，存在异常值，所以把图像放大来处理异常值。

```{r echo=FALSE, message=FALSE, warning=FALSE}
#放大图片处理异常值
qplot(x= residual.sugar, data = rw, ylab = 'count') +
  scale_x_continuous(breaks = seq(0, 4, 1), lim = c(0,4))
```
```{r echo=FALSE, message=FALSE}
summary(rw$residual.sugar)
```

残糖含量大多数在1-4（g/dm^3）之间，中位数为2.200（g/dm^3），平均值为2.539（g/dm^3）。

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x= chlorides, data = rw, ylab = 'count')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x= chlorides, data = rw, ylab = 'count') +
  scale_x_continuous(breaks = seq(0, 0.2, 0.1), lim = c(0,0.2))
```

转换长尾数据，氯化物含量近似呈正态分布。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = free.sulfur.dioxide, data = rw, ylab = 'count')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
#转换长尾数据
ggplot(aes(x = free.sulfur.dioxide), data = rw) +
  geom_histogram() +
  scale_x_log10()
```

转换长尾数据后，游离二氧化硫呈近似正态分布。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = total.sulfur.dioxide, data = rw, ylab = 'count')
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
#转换长尾数据
ggplot(aes(x = free.sulfur.dioxide), data = rw) +
  geom_histogram() +
  scale_x_log10()
```

转换长尾数据后，二氧化硫总量呈近似正态分布。

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = density, data = rw, ylab = 'count')
```

密度呈正态分布。大多数在0.995-1.000(g/cm^3)之间。密度对评分影响很小，各种红葡萄酒的液体密度基本相同，评分的主要判断依据是气味和口感等。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = pH, data = rw, ylab = 'count')
```

pH值呈正态分布，大多数位于3.2-3.5之间，呈酸性。评分是依靠评审专家的味觉来决定的，可能酸度不太明显，尝不出变化。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = sulphates, data = rw, ylab = 'count')
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = sulphates, data = rw, ylab = 'count') +
  scale_x_continuous(breaks = seq(0.3, 1, 0.2), lim = c(0.3,1))
```

硫酸盐呈现近似正态分布，经查资料得知，硫酸盐是一种在葡萄酒中添加的防腐剂，不会影响到酒的口感，所以硫酸盐含量和评分可能没有直接相关。


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = alcohol, data = rw, ylab = 'count')
```
```{r echo=FALSE, message=FALSE}
summary(rw$alcohol)
```
酒精浓度大多数位于8-12之间，中位数为10.20，平均值为10.42。酒精浓度是由葡萄酒发酵程度决定的，所以酒精浓度的变化应该和最终的质量评分有很大的相关性。


# 单变量分析

- 数据集中有1599种红酒，有11个特征（固定酸度，挥发性酸度，柠檬酸，残糖，氯化物，游离二氧化硫，二氧化硫总量，密度，pH，硫酸盐，酒精），以及一个有序因子变量quality,分为3，4，5，6，7，8这几个评级。
其他观察：
  - 大多数红酒的评级在5，6，7之间；
  - 大多数挥发性酸度含量在0.3-0.7（g/dm^3) 之间，中位数为0.5200（g/dm^3)；
  - 酒精含量的中位数为10.2

- 我对数据集感兴趣的主要特性是质量和酸度。我想确定哪些特征最适合预测红酒的质量。我猜测酸度和其他变量的某些组合可以用来建立一个预测模型来评估红酒质量的级别。

- 挥发性酸度，固定酸度，柠檬酸，残糖，酒精可能会影响红酒的质量。我认为在研究红酒质量评级后，挥发性酸度和酒精可能对红酒质量影响最大。

- 为了后续对比分析每个特性对红酒质量的影响，创建一个新变量‘grade':质量等级，将葡萄酒质量分为'high'(质量分7-8)，'ordinary'(质量分5-6)，'low'(质量分3-4)

```{r echo=FALSE}
#创建新变量
rw$grade <- ifelse(rw$quality >6, 'high', ifelse(rw$quality > 4, 'middle', 'low'))
rw$grade <- ordered(rw$grade, levels = c('low', 'middle', 'high'))
summary(rw$grade)
```


- 在进行残糖和氯化物的绘图的时候，将长尾数据去除了。在进行游离二氧化硫和二氧化硫总量的绘图时，为了更好的看出数据特征，将长尾数据通过log转换为近似正态分布的数据。



# 双变量绘图选择


质量与挥发性酸度的散点图。

```{r echo=FALSE, Bivariate_Plots}
qplot(quality, volatile.acidity, data = rw)
```

高竖条表示值大多是整数。 添加抖动，透明度和更改绘图限制可以让我们看到质量与挥发性酸度之间的关联。


```{r echo=FALSE,warning=FALSE}
#绘制连续变量间的散点图
ggplot(aes(x = quality, y = volatile.acidity), data = rw) +
  geom_jitter(alpha = 0.5, position = position_jitter(h = 0)) +
  xlim(3,8) +
  coord_trans(y = 'sqrt') +
  geom_smooth(method = 'lm', color = 'blue')
```

  由散点图看出，挥发性酸度与红酒质量具有一定的相关性。


```{r echo=FALSE,warning=FALSE}
ggplot(aes(x = quality, y = residual.sugar), data = rw) +
  geom_jitter(alpha = 0.5, position = position_jitter(h = 0)) +
  xlim(3,8) +
  coord_trans(y = 'sqrt') +
  geom_smooth(method = 'lm', color = 'blue')
```

  残糖含量与红酒质量的相关性不高。


```{r echo=FALSE,warning=FALSE}
ggplot(aes(x = quality, y = alcohol), data = rw) +
  geom_jitter(alpha = 0.5, position = position_jitter(h = 0)) +
  xlim(3,8) +
  coord_trans(y = 'sqrt') +
  geom_smooth(method = 'lm', color = 'blue')
```

  由散点图看出，酒精与红酒质量具有一定的相关性。

  对挥发性酸度和酒精浓度绘制散点图，观察是否存在相关性。

```{r echo=FALSE}
ggplot(aes(x = alcohol, y = volatile.acidity), data = rw) +
  geom_jitter(alpha = 0.5, position = position_jitter(h = 0)) +
  coord_trans(y = 'sqrt')
```

  挥发性酸度和酒精浓度不存在相关性。

  由于质量是分等级的，所以将其作为分类变量quality.f, 进行进一步的分析。

```{r echo=FALSE}
ggplot(aes(quality.f, fixed.acidity), data = rw) +
  geom_boxplot(alpha = 0.5) + 
  coord_cartesian(ylim = c(4, 16))
```

  固定酸度与质量相关性不大。

```{r echo=FALSE}
ggplot(aes(quality.f, volatile.acidity), data = rw) +
  geom_boxplot(alpha = 0.5)
```
      
  挥发性酸度与质量呈负相关。

```{r echo=FALSE}
ggplot(aes(quality.f, citric.acid), data = rw) +
  geom_boxplot(alpha = 0.5)
```
      
  柠檬酸和酒精与质量呈正相关。

```{r echo=FALSE,warning=FALSE}
ggplot(aes(quality.f, residual.sugar), data = rw) +
  ylim(0, 4) +
  geom_boxplot(alpha = 0.5)
```
    
  残糖与质量相关性不大。

```{r echo=FALSE}
ggplot(aes(quality.f, alcohol), data = rw) +
  geom_boxplot(alpha = 0.5)

```
    
  酒精浓度与质量呈正相关。

```{r echo=FALSE,warning=FALSE}
ggplot(aes(quality.f, sulphates), data = rw) +
  ylim(0, 1.5) +
  geom_boxplot(alpha = 0.5)
```

  硫酸盐含量与质量呈现也有比较弱的相关性。


#### 相关性

计算各变量与质量间的相关系数：

```{r echo=FALSE}
with(rw, cor.test(quality, volatile.acidity, method = 'pearson'))
with(rw, cor.test(quality, residual.sugar, method = 'pearson'))
with(rw, cor.test(quality, alcohol, method = 'pearson'))
with(rw, cor.test(quality, sulphates, method = 'pearson'))
with(rw, cor.test(quality, citric.acid, method = 'pearson'))
with(rw, cor.test(quality, fixed.acidity, method = 'pearson'))
```

与葡萄酒质量相关性较高的变量：

- 挥发性酸度：0.391
- 硫酸盐：0.251
- 柠檬酸 0.226
- 酒精：0.476



# 双变量分析

- 从这部分的探究中观察到质量与酒精，柠檬酸的含量以及硫酸盐的含量呈正相关，与挥发性酸度呈负相关。

- 残糖这个特性与质量几乎没有关系，可能专家评审会从红酒的气味，口感，颜色等方面进行评级，而葡萄酒中的糖含量很少，
在专家评审时甜味会被酸味覆盖。同时，挥发性酸度过高会有比较刺激的酸味出现，所以挥发性与质量呈现很强的负相关。

- 质量与挥发性酸度有很强的负相关关系，而质量与酒精有很强的正相关关系。可以在模型中使用挥发性酸度，酒精浓度或柠檬酸含量来评估葡萄酒的质量。


# 多变量绘图选择

```{r echo=FALSE, Multivariate_Plots,message=FALSE}
#为散点图添加颜色编码图层
ggplot(rw, aes(alcohol, volatile.acidity)) +
  geom_point(aes(colour = grade)) +
  scale_colour_brewer(palette = "PuOr") +
  #使背景变暗以便看到浅色点
  theme_dark() +
  labs(x = 'Alcohol (mg/L)',
       y = 'Volatile.acidity(g/dm^3)',
       title = 'Reletionship of alcohol and volatile.acidity with colored quality grade')
```

酒精浓度和挥发性酸度对评估红酒质量起决定性作用。当挥发性酸度极高时，红酒质量会极低，当酒精浓度很高时且挥发性酸度不高时，红酒质量才可能会高。当两者都居中时，红酒质量会受到其他特性的影响，比如柠檬酸。


```{r echo=FALSE,message=FALSE}
#为散点图添加颜色编码图层
ggplot(rw, aes(alcohol, citric.acid)) +
  geom_point(aes(colour = grade)) +
  scale_colour_brewer(palette = "PuOr") +
  #使背景变暗以便看到浅色点
  theme_dark() +
  labs(x = 'Alcohol (mg/L)',
       y = 'Citric.acid(g/dm^3)',
       title = 'Reletionship of alcohol and citric.acid with colored quality grade')
```

当酒精浓度偏高时，质量评分非常高，柠檬酸对质量评分几乎没有影响。

探索其他相关特性的：

```{r echo=FALSE}
#为散点图添加颜色编码图层
ggplot(rw, aes(alcohol, sulphates)) +
  geom_point(aes(colour = grade)) +
  scale_colour_brewer(palette = "PuOr") +
  #使背景变暗以便看到浅色点
  theme_dark() +
  labs(x = 'Alcohol (mg/L)',
       y = 'Sulphates (g/dm^3)',
       title = 'Reletionship of alcohol and sulphates with colored quality grade')
```

当酒精浓度偏高时，质量评分同时也非常高。当酒精浓度中等或较低时， 硫酸盐含量越高红酒质量越高。


```{r echo=FALSE}
#为散点图添加颜色编码图层
ggplot(rw, aes(volatile.acidity, citric.acid)) +
  geom_point(aes(colour = grade)) +
  scale_colour_brewer(palette = "PuOr") +
  #使背景变暗以便看到浅色点
  theme_dark() +
  labs(x = 'Volatile.acidity (mg/L)',
       y = 'Citric.acid (g/dm^3)',
       title = 'Reletionship of volatile.acidity and citric.acid with colored quality grade')
```

由上图可以看出来，三个变量之间的关联性不大。


```{r echo=FALSE}
#为散点图添加颜色编码图层
ggplot(rw, aes(volatile.acidity, sulphates)) +
  geom_point(aes(colour = grade)) +
  scale_colour_brewer(palette = "PuOr") +
  #使背景变暗以便看到浅色点
  theme_dark() +
  labs(x = 'Volatile.acidity (mg/L)',
       y = 'Sulphates (g/dm^3)',
       title = 'Reletionship of volatile.acidity and sulphates with colored quality grade')
```


# 多变量分析

添加第三个变量对最后的质量评分似乎影响不大。只有当挥发性酸度和酒精浓度这两个变量的值都居中时，评分才会受到添加的其它变量的影响。


------

# 总结

### 绘图
```{r echo=FALSE, Plot_One}
quality.f <- factor(rw$quality)
qplot(x = quality.f, data = rw, main = 'Quality Distribution', ylab = 'count')
```

### 描述
红葡萄酒的质量评级中最高和最低的比较少，大多数集中在5-6的中间位置。专家评审打低分和高分时都会比较慎重，只有某些特性很差或确实特别好时才会给低分和高分，同时也说明大多数红葡萄酒都比较普通。


### 绘图
```{r echo=FALSE, Plot_Two}
ggplot(aes(quality.f, volatile.acidity), data = rw) +
  geom_boxplot(alpha = 0.5) +
  ylab('Volatile.acidity(g/dm^3)') +
ggtitle('Quality vs. Volatile.acidity')
```
```{r echo=FALSE}
ggplot(aes(quality.f, alcohol), data = rw) +
  geom_boxplot(alpha = 0.5) +
  ylab('alcohol(mg/L)') +
  ggtitle('Quality vs. Alcohol')
```


### 描述
高质量的红酒有极低的挥发性酸度和最高的酒精浓度，而低质量的红酒有最高的挥发性酸度和较低的酒精度。

### 绘图

```{r echo=FALSE}
#为散点图添加颜色编码图层
ggplot(rw, aes(alcohol, volatile.acidity)) +
  geom_point(aes(colour = grade)) +
  scale_colour_brewer(palette = "PuOr") +
  #使背景变暗以便看到浅色点
  theme_dark() +
  labs(x = 'Alcohol (mg/L)',
       y = 'Volatile.acidity(g/dm^3)',
       title = 'Reletionship of alcohol and volatile.acidity with colored quality grade')
```

### 描述

酒精浓度和挥发性酸度对评估红酒质量起决定性作用。当挥发性酸度极高时，红酒质量会极低，当酒精浓度很高时且挥发性酸度不高时，红酒质量才可能会高。当两者都居中时，红酒质量会受到其他特性的影响，比如柠檬酸。

------

# 反思

红葡萄酒数据集包含了1559种红酒，12个变量的信息。我首先了解了数据集中的各个变量，明确最重要的是评估红酒的质量，所以先对每个变量进行了分析，然后把其中的几个变量和质量进行双变量分析，最后进行了两个变量和红酒质量的分析。通过对图表进行观察，我找到了变量间的相关性，探索了如何评估红酒这个有趣的问题。

红酒的挥发性酸度和酒精浓度与其质量之间存在明显的相关性。我最开始认为糖含量和柠檬酸会与质量存在比较强的正相关，经过双变量分析后排除了糖含量，接着对其他已经分析出的变量进行多变量分析，观察他们之间的相关性。为了更好的比较出其它特性哪种对红酒的质量影响大，我创建了分类变量‘grade',将红酒质量分为高质量，低质量，和中间占大多数的中等质量，通过对比，我发现挥发性酸度对红酒质量的影响很大，基本上对是否评为低质量起决定性作用。所以，红酒生产商要想提高红酒的质量，首先就要去降低挥发性酸度，这可能需要提高葡萄酒酿造技术。

最后，将来在工作中我需要多练习R语言，做更多的分析案例，提高思维能力和编程能力，尤其是急需学习ggplot库，以便以后画图时能轻松一些。
